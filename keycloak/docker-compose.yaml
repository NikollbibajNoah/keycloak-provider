version: '3.7'
services:
  keycloak:
    image: quay.io/keycloak/keycloak:21.0.1
    ports:
      - "8080:8080"
    environment:
      - DB_VENDOR=postgres
      - DB_ADDR=dpg-d00evkadbo4c7390i990-a.frankfurt-postgres.render.com
      - DB_PORT=5432
      - DB_USER=nocan
      - DB_PASSWORD=vfxBspx0i5Lgta8AfeIKfiErDHy8PMjW
      - DB_DATABASE=filmverleih
      - DB_SCHEMA=keycloak
      - KEYCLOAK_FRAME_SRC=https://keycloak-provider.onrender.com
      - KC_HOSTNAME=https://keycloak-provider.onrender.com
      - KC_HOSTNAME_STRICT_HTTPS=true
      - KEYCLOAK_PROXY=edge
      - KEYCLOAK_PROXY_ADDRESS_FORWARDING=true
      - KEYCLOAK_FRONTEND_URL=https://keycloak-provider.onrender.com/auth
      - KC_FRAME_OPTIONS=SAMEORIGIN
      - KC_CONTENT_SECURITY_POLICY=frame-src 'self' ${FRONTEND_URL}; frame-ancestors 'self' ${FRONTEND_URL};
    volumes:
      - keycloak_data:/opt/keycloak/data
volumes:
  keycloak_data:
